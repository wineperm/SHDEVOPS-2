# Домашнее задание к занятию «Обновление приложений»

### Цель задания

Выбрать и настроить стратегию обновления приложения.

### Чеклист готовности к домашнему заданию

1. Кластер K8s.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Updating a Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment).
2. [Статья про стратегии обновлений](https://habr.com/ru/companies/flant/articles/471620/).

---

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения, ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Вам нужно объяснить свой выбор стратегии обновления приложения.

## Ответ

Выбор стратегии обновления приложения зависит от многих факторов, таких как допустимое время простоя, требования к согласованности данных, нагрузка на приложение и т.д. В данном случае, учитывая ограниченность ресурсов и невозможность увеличения их количества, а также то, что новые версии приложения не умеют работать со старыми, наиболее подходящей стратегией обновления будет "Recreate deployment".

Стратегия "Recreate deployment" подразумевает, что перед развертыванием новой версии приложения все экземпляры старой версии будут удалены. После этого будет произведено развертывание новой версии приложения. Это гарантирует, что все экземпляры приложения будут работать на одной и той же версии, и не будет никаких проблем с совместимостью.

Однако, недостатком этой стратегии является то, что приложение будет недоступно на время обновления, так как все экземпляры приложения будут временно остановлены. Это может быть неприемлемо для приложений, требующих высокой доступности.

В данном случае, учитывая что запас по ресурсам в менее загруженный момент времени составляет 20%, можно попробовать произвести обновление в это время, чтобы минимизировать время простоя приложения. Кроме того, перед обновлением необходимо убедиться, что все данные приложения были надлежащим образом сохранены и будут доступны для новой версии приложения.

### Задание 2. Обновить приложение

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Количество реплик — 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

## Ответ

[deploy_nginx_multitool.yaml](https://github.com/wineperm/SHDEVOPS-2/blob/main/kuber-homeworks/3.4/deploy_nginx_multitool.yaml)

[svc_nginx_multitool.yaml](https://github.com/wineperm/SHDEVOPS-2/blob/main/kuber-homeworks/3.4/svc_nginx_multitool.yaml)

![Alt text](https://github.com/wineperm/SHDEVOPS-2/assets/15356046/299dd024-62ed-4693-a0aa-5b7421604db6)

![Alt text](https://github.com/wineperm/SHDEVOPS-2/assets/15356046/026eb5d1-5966-463f-be31-3bd6634a3cea)

![Alt text](https://github.com/wineperm/SHDEVOPS-2/assets/15356046/4f9795a0-c5be-43a9-9d08-5024359c5a03)

## Дополнительные задания — со звёздочкой\*

Задания дополнительные, необязательные к выполнению, они не повлияют на получение зачёта по домашнему заданию. **Но мы настоятельно рекомендуем вам выполнять все задания со звёздочкой.** Это поможет лучше разобраться в материале.

### Задание 3\*. Создать Canary deployment

1. Создать два deployment'а приложения nginx.
2. При помощи разных ConfigMap сделать две версии приложения — веб-страницы.
3. С помощью ingress создать канареечный деплоймент, чтобы можно было часть трафика перебросить на разные версии приложения.

### Правила приёма работы

1. Домашняя работа оформляется в своем Git-репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов.
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md.
